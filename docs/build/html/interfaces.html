
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>The socket interface &#8212; PyDSS 0.0.1 documentation</title>
    <link rel="stylesheet" href="_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/graphviz.css" />
    
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Automated scenario comparison" href="Automated comparison of scenarios.html" />
    <link rel="prev" title="External PyDSS interfaces" href="External interfaces for cosimulation.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="Automated comparison of scenarios.html" title="Automated scenario comparison"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="External interfaces for cosimulation.html" title="External PyDSS interfaces"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">PyDSS 0.0.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="External interfaces for cosimulation.html" accesskey="U">External PyDSS interfaces</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <p>Within the example folder the project named external interfaces provides an example usage of all three interafces.</p>
<div class="section" id="the-socket-interface">
<h1>The socket interface<a class="headerlink" href="#the-socket-interface" title="Permalink to this headline">¶</a></h1>
<p>The socket interface is implemented as a PyDSS pyController. Implmentation details and expected inputs are detailed here: <a class="reference internal" href="PyDSS controllers.html#socket-controller"><span class="std std-ref">Socket controller</span></a>. The socket controller is weill suited in situatons where an existing controller needs to be integrated to the simulation environment. An exmaple of this would be integrating a controller for thermostatically controlled loads implemeted in say Modelica or Python. This allows user to integrate controller, without making changes to the implemented controller. With a little effort, the same controller can be implemented as a pyController object in PyDSS.</p>
<p>The socket interface in PyDSS also come in handy, when setting up a hardware-in-loop type simulations and integrating the simulation engine with actual hardware. Interfaces similar to raw socket implementations have been developed (to be  open-sourced at a time) for Modbus-TCP and DNP3 communcations have developed and tested with PyDSS with sucess. A minimal socket interfacing example has been provided as a PyDSS project in ~PyDSS/exmaples/External_interfacing_example. Within the folder, ~/PyDSS/examples/External_interfacing_example/pyDSS_project a scenario called ‘socket_interface’ has been defined. Socket contntroller definations have been detailed with the ‘pyControllerList’ folder.</p>
<table class="docutils align-default" id="id1">
<caption><span class="caption-text">A example implementation SocketController definations</span><a class="headerlink" href="#id1" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width: 13%" />
<col style="width: 13%" />
<col style="width: 13%" />
<col style="width: 13%" />
<col style="width: 13%" />
<col style="width: 13%" />
<col style="width: 13%" />
<col style="width: 13%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Controlled Element</p></th>
<th class="head"><p>IP</p></th>
<th class="head"><p>Port</p></th>
<th class="head"><p>Encoding</p></th>
<th class="head"><p>Buffer</p></th>
<th class="head"><p>Index</p></th>
<th class="head"><p>Inputs</p></th>
<th class="head"><p>Outputs</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Load. mpx000635970</p></td>
<td><p>127.0.0.1</p></td>
<td><p>5001</p></td>
<td><p>None</p></td>
<td><p>1024</p></td>
<td><p>Even, Even</p></td>
<td><p>VoltagesMagAng ,Powers</p></td>
<td><p>kW</p></td>
</tr>
<tr class="row-odd"><td><p>Load. mpx000460267</p></td>
<td><p>127.0.0.1</p></td>
<td><p>5002</p></td>
<td><p>None</p></td>
<td><p>1024</p></td>
<td><p>Even, Even</p></td>
<td><p>VoltagesMagAng, Powers</p></td>
<td><p>kW</p></td>
</tr>
</tbody>
</table>
<p>In this example, each iteration, voltage and power information is being exported via the socket and new value recieved is used to update the ‘kW’ property of the load. Once the inputs, outputs, IP and port have been defined, the next step is to create a TOML file and define simulation settings.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;Project Path&quot;</span> <span class="o">=</span> <span class="s2">&quot;C:</span><span class="se">\\</span><span class="s2">Users</span><span class="se">\\</span><span class="s2">alatif</span><span class="se">\\</span><span class="s2">Desktop</span><span class="se">\\</span><span class="s2">PyDSS</span><span class="se">\\</span><span class="s2">examples</span><span class="se">\\</span><span class="s2">External_interfacing_example&quot;</span>
<span class="s2">&quot;Simulation Type&quot;</span> <span class="o">=</span> <span class="s2">&quot;QSTS&quot;</span>
<span class="s2">&quot;Active Project&quot;</span> <span class="o">=</span> <span class="s2">&quot;pyDSS_project&quot;</span>
<span class="s2">&quot;Active Scenario&quot;</span> <span class="o">=</span> <span class="s2">&quot;socket_interface&quot;</span>
<span class="s2">&quot;DSS File&quot;</span> <span class="o">=</span> <span class="s2">&quot;Master_Spohn_existing_VV.dss&quot;</span>
</pre></div>
</div>
<p>A small script is used to run the particular scenario.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">click</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="nd">@click.command</span><span class="p">()</span>
<span class="nd">@click.option</span><span class="p">(</span><span class="s1">&#39;--pydss_path&#39;</span><span class="p">,</span>
                          <span class="n">default</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;C:\Users\alatif\Desktop\PyDSS&#39;</span><span class="p">)</span>
<span class="nd">@click.option</span><span class="p">(</span><span class="s1">&#39;--sim_path&#39;</span><span class="p">,</span>
                          <span class="n">default</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;C:\Users\alatif\Desktop\PyDSS\examples\External_interfacing_example\pyDSS_project\PyDSS Scenarios&#39;</span><span class="p">)</span>
<span class="nd">@click.option</span><span class="p">(</span><span class="s1">&#39;--sim_file&#39;</span><span class="p">,</span>
                          <span class="n">default</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;socket_interface.toml&#39;</span><span class="p">)</span> <span class="c1">#The TOML file contains simulation settings for the particular scenario</span>
<span class="k">def</span> <span class="nf">run_pyDSS</span><span class="p">(</span><span class="n">pydss_path</span><span class="p">,</span> <span class="n">sim_path</span><span class="p">,</span> <span class="n">sim_file</span><span class="p">):</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pydss_path</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pydss_path</span><span class="p">,</span> <span class="s1">&#39;PyDSS&#39;</span><span class="p">))</span>
        <span class="kn">from</span> <span class="nn">pyDSS</span> <span class="kn">import</span> <span class="n">instance</span> <span class="k">as</span> <span class="n">dssInstance</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">dssInstance</span><span class="p">()</span>                           <span class="c1">#Create an instance of PyDSS</span>
        <span class="n">a</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sim_path</span><span class="p">,</span> <span class="n">sim_file</span><span class="p">))</span>     <span class="c1">#Run the simulation</span>

<span class="n">run_pyDSS</span><span class="p">()</span>
</pre></div>
</div>
<p>Finally, the minimal example below shows how to retrive data from the sockets and return new values for parameters defined in the definations file.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># first of all import the socket library</span>
<span class="kn">import</span> <span class="nn">socket</span>
<span class="kn">import</span> <span class="nn">struct</span>

<span class="c1"># next create a socket object</span>
<span class="n">sockets</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">()</span>
        <span class="n">s</span><span class="o">.</span><span class="n">bind</span><span class="p">((</span><span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span> <span class="mi">5001</span> <span class="o">+</span> <span class="n">i</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;socket binded to </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="mi">5001</span> <span class="o">+</span> <span class="n">i</span><span class="p">))</span>
        <span class="n">s</span><span class="o">.</span><span class="n">listen</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">sockets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="c1"># Establish connection with client.</span>
        <span class="n">conns</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">sockets</span><span class="p">:</span>
                <span class="n">c</span><span class="p">,</span> <span class="n">addr</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span>
                <span class="n">conns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
                <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Got connection from&#39;</span><span class="p">,</span> <span class="n">addr</span><span class="p">)</span>
        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">conns</span><span class="p">:</span> <span class="c1">#Reading data from all ports</span>
                        <span class="n">Data</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">Data</span><span class="p">:</span> <span class="c1">#Creating a list of doubles from the recieved byte stream</span>
                                <span class="n">numDoubles</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Data</span><span class="p">)</span> <span class="o">/</span> <span class="mi">8</span><span class="p">)</span>
                                <span class="n">tag</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">numDoubles</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;d&#39;</span>
                                <span class="n">Data</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="n">Data</span><span class="p">))</span>
                                <span class="k">print</span><span class="p">(</span><span class="n">Data</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">c</span> <span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">conns</span><span class="p">,</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">]):</span> <span class="c1">#Writing data to all ports</span>
                        <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span><span class="p">]</span>
                        <span class="n">c</span><span class="o">.</span><span class="n">sendall</span><span class="p">(</span><span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">d&#39;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">),</span> <span class="o">*</span><span class="n">values</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="the-helics-interface">
<h1>The HELICS interface<a class="headerlink" href="#the-helics-interface" title="Permalink to this headline">¶</a></h1>
<p>Hierarchical Engine for Large-scale Infrastructure Co-Simulation (HELICS) provides an open-source, general-purpose, modular, highly-scalable co-simulation framework that runs cross-platform (Linux, Windows, and Mac OS X). It is not a modeling tool by itself, but rather an integration tool that enables multiple existing simulation tools (and/or multiple instances of the same tool), known as “federates,” to exchange data during runtime and stay synchronized in time such that together they act as one large simulation, or “federation”. This enables bringing together established (or new/emerging) off-the-shelf tools from multiple domains to form a complex software-simulation without having to change the individual tools (known as “black-box” modeling). All that is required is for someone to write a thin interface layer for each tool that interfaces with existing simulation time control and data value updating, such as through an existing scripting interface. Moreover, the HELICS community has a growing ecosystem of established interfaces for popular tools, such that many users can simply mix and match existing tools with their own data and run complex co-simulations with minimal coding. More information on HELICS can be found here (<a class="reference external" href="https://github.com/GMLC-TDC/HELICS">https://github.com/GMLC-TDC/HELICS</a>).</p>
<p>The HELICS interface for PyDSS is built to reduuce complexity of setting up large scale cosimulation scenarios. The user is requuired to publications and suscriptions. Details on the formathave been detailed here: <a class="reference internal" href="Result management.html#enhanced-result-export-features"><span class="std std-ref">Enhanced result export features</span></a></p>
<p>A minimal HELICS interfacing example has been provided as a PyDSS project in ~PyDSS/exmaples/External_interfacing_example. Within the folder, ~PyDSS/examples/External_interfacing_example/pyDSS_project a scenario called ‘helics_interface’ has been defined. Enabling the HELICS interface requires user to define additional patammeters in the scenario TOML file.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;Project Path&quot;</span> <span class="o">=</span> <span class="s2">&quot;C:</span><span class="se">\\</span><span class="s2">Users</span><span class="se">\\</span><span class="s2">alatif</span><span class="se">\\</span><span class="s2">Desktop</span><span class="se">\\</span><span class="s2">PyDSS</span><span class="se">\\</span><span class="s2">examples</span><span class="se">\\</span><span class="s2">External_interfacing_example&quot;</span>
<span class="s2">&quot;Simulation Type&quot;</span> <span class="o">=</span> <span class="s2">&quot;QSTS&quot;</span>
<span class="s2">&quot;Active Project&quot;</span> <span class="o">=</span> <span class="s2">&quot;pyDSS_project&quot;</span>
<span class="s2">&quot;Active Scenario&quot;</span> <span class="o">=</span> <span class="s2">&quot;helics_interface&quot;</span>
<span class="s2">&quot;DSS File&quot;</span> <span class="o">=</span> <span class="s2">&quot;Master_Spohn_existing_VV.dss&quot;</span>
<span class="s2">&quot;Co-simulation Mode&quot;</span> <span class="o">=</span> <span class="n">true</span>
<span class="s2">&quot;Federate name&quot;</span> <span class="o">=</span> <span class="s2">&quot;PyDSS&quot;</span>
</pre></div>
</div>
<ul class="simple">
<li><p>“Co-simulation Mode” : Set to ‘true’ to enable the HELICS interface. By default it is set to ‘false’</p></li>
<li><p>“Federate name” : Required to identify a federate ina cosimulation with a large number of federates.</p></li>
</ul>
<p>Default values for additional simulation settings are as follows. For more information on how to appropriately set these values please look at HELICS documentaion</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;Time delta&quot;</span> <span class="o">=</span> <span class="mf">0.01</span>
<span class="s2">&quot;Core type&quot;</span> <span class="o">=</span> <span class="s2">&quot;zmq&quot;</span>
<span class="s2">&quot;Uninterruptible&quot;</span> <span class="o">=</span> <span class="n">true</span>
<span class="s2">&quot;Helics logging level&quot;</span> <span class="o">=</span> <span class="mi">5</span>
</pre></div>
</div>
<p>For a helics example a minimal dummy federate has been defined using the HELICS Python interaface. The dummy federate script creates a broker and a federate. The federate subsscribes to feeder total power and publishes actie power values for three loads in the network.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">helics</span> <span class="kn">as</span> <span class="nn">h</span>
<span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">pi</span>
<span class="kn">import</span> <span class="nn">random</span>

<span class="n">initstring</span> <span class="o">=</span> <span class="s2">&quot;-f 2 --name=mainbroker&quot;</span>
<span class="n">fedinitstring</span> <span class="o">=</span> <span class="s2">&quot;--broker=mainbroker --federates=1&quot;</span>
<span class="n">deltat</span> <span class="o">=</span> <span class="mf">0.01</span>

<span class="n">helicsversion</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">helicsGetVersion</span><span class="p">()</span>

<span class="k">print</span><span class="p">(</span><span class="s2">&quot;PI SENDER: Helics version = {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">helicsversion</span><span class="p">))</span>

<span class="c1"># Create broker #</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;Creating Broker&quot;</span><span class="p">)</span>
<span class="n">broker</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">helicsCreateBroker</span><span class="p">(</span><span class="s2">&quot;zmq&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">initstring</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;Created Broker&quot;</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s2">&quot;Checking if Broker is connected&quot;</span><span class="p">)</span>
<span class="n">isconnected</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">helicsBrokerIsConnected</span><span class="p">(</span><span class="n">broker</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;Checked if Broker is connected&quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="n">isconnected</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Broker created and connected&quot;</span><span class="p">)</span>

<span class="c1"># Create Federate Info object that describes the federate properties #</span>
<span class="n">fedinfo</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">helicsCreateFederateInfo</span><span class="p">()</span>

<span class="c1"># Set Federate name #</span>
<span class="n">h</span><span class="o">.</span><span class="n">helicsFederateInfoSetCoreName</span><span class="p">(</span><span class="n">fedinfo</span><span class="p">,</span> <span class="s2">&quot;Test Federate&quot;</span><span class="p">)</span>

<span class="c1"># Set core type from string #</span>
<span class="n">h</span><span class="o">.</span><span class="n">helicsFederateInfoSetCoreTypeFromString</span><span class="p">(</span><span class="n">fedinfo</span><span class="p">,</span> <span class="s2">&quot;zmq&quot;</span><span class="p">)</span>

<span class="c1"># Federate init string #</span>
<span class="n">h</span><span class="o">.</span><span class="n">helicsFederateInfoSetCoreInitString</span><span class="p">(</span><span class="n">fedinfo</span><span class="p">,</span> <span class="n">fedinitstring</span><span class="p">)</span>

<span class="c1"># Set the message interval (timedelta) for federate. Note th#</span>
<span class="c1"># HELICS minimum message time interval is 1 ns and by default</span>
<span class="c1"># it uses a time delta of 1 second. What is provided to the</span>
<span class="c1"># setTimedelta routine is a multiplier for the default timedelta.</span>

<span class="c1"># Set one second message interval #</span>
<span class="n">h</span><span class="o">.</span><span class="n">helicsFederateInfoSetTimeProperty</span><span class="p">(</span><span class="n">fedinfo</span><span class="p">,</span> <span class="n">h</span><span class="o">.</span><span class="n">helics_property_time_delta</span><span class="p">,</span> <span class="n">deltat</span><span class="p">)</span>

<span class="c1"># Create value federate #</span>
<span class="n">vfed</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">helicsCreateValueFederate</span><span class="p">(</span><span class="s2">&quot;Test Federate&quot;</span><span class="p">,</span> <span class="n">fedinfo</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;PI SENDER: Value federate created&quot;</span><span class="p">)</span>

<span class="c1"># Register the publication #</span>
<span class="n">pub1</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">helicsFederateRegisterGlobalTypePublication</span><span class="p">(</span><span class="n">vfed</span><span class="p">,</span> <span class="s2">&quot;test.load1.power&quot;</span><span class="p">,</span> <span class="s2">&quot;double&quot;</span><span class="p">,</span> <span class="s2">&quot;kW&quot;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;PI SENDER: Publication registered&quot;</span><span class="p">)</span>
<span class="n">pub2</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">helicsFederateRegisterGlobalTypePublication</span><span class="p">(</span><span class="n">vfed</span><span class="p">,</span> <span class="s2">&quot;test.load2.power&quot;</span><span class="p">,</span> <span class="s2">&quot;double&quot;</span><span class="p">,</span> <span class="s2">&quot;kW&quot;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;PI SENDER: Publication registered&quot;</span><span class="p">)</span>
<span class="n">pub3</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">helicsFederateRegisterGlobalTypePublication</span><span class="p">(</span><span class="n">vfed</span><span class="p">,</span> <span class="s2">&quot;test.load3.power&quot;</span><span class="p">,</span> <span class="s2">&quot;double&quot;</span><span class="p">,</span> <span class="s2">&quot;kW&quot;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;PI SENDER: Publication registered&quot;</span><span class="p">)</span>
<span class="n">sub1</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">helicsFederateRegisterSubscription</span><span class="p">(</span><span class="n">vfed</span><span class="p">,</span> <span class="s2">&quot;Circuit.heco19021.TotalPower.E&quot;</span><span class="p">,</span> <span class="s2">&quot;kW&quot;</span><span class="p">)</span>
<span class="c1"># Enter execution mode #</span>
<span class="n">h</span><span class="o">.</span><span class="n">helicsFederateEnterExecutingMode</span><span class="p">(</span><span class="n">vfed</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;PI SENDER: Entering execution mode&quot;</span><span class="p">)</span>

<span class="c1"># This federate will be publishing deltat*pi for numsteps steps #</span>

<span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">96</span><span class="p">):</span>
        <span class="n">currenttime</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">helicsFederateRequestTime</span><span class="p">(</span><span class="n">vfed</span><span class="p">,</span> <span class="n">t</span> <span class="o">*</span> <span class="mi">15</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
        <span class="n">h</span><span class="o">.</span><span class="n">helicsPublicationPublishDouble</span><span class="p">(</span><span class="n">pub1</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">)</span>
        <span class="n">h</span><span class="o">.</span><span class="n">helicsPublicationPublishDouble</span><span class="p">(</span><span class="n">pub2</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">)</span>
        <span class="n">h</span><span class="o">.</span><span class="n">helicsPublicationPublishDouble</span><span class="p">(</span><span class="n">pub3</span><span class="p">,</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">*</span> <span class="mi">12</span><span class="p">)</span>

        <span class="n">value</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">helicsInputGetString</span><span class="p">(</span><span class="n">sub1</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span>
                <span class="s2">&quot;Circuit active power demand: {} kW @ time: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">value</span><span class="p">,</span> <span class="n">currenttime</span>
                <span class="p">)</span>
        <span class="p">)</span>

        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.01</span><span class="p">)</span>

<span class="n">h</span><span class="o">.</span><span class="n">helicsFederateFinalize</span><span class="p">(</span><span class="n">vfed</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;PI SENDER: Federate finalized&quot;</span><span class="p">)</span>

<span class="k">while</span> <span class="n">h</span><span class="o">.</span><span class="n">helicsBrokerIsConnected</span><span class="p">(</span><span class="n">broker</span><span class="p">):</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="n">h</span><span class="o">.</span><span class="n">helicsFederateFree</span><span class="p">(</span><span class="n">vfed</span><span class="p">)</span>
<span class="n">h</span><span class="o">.</span><span class="n">helicsCloseLibrary</span><span class="p">()</span>

<span class="k">print</span><span class="p">(</span><span class="s2">&quot;PI SENDER: Broker disconnected&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="the-api-interface">
<h1>The API interface<a class="headerlink" href="#the-api-interface" title="Permalink to this headline">¶</a></h1>
<p>Using the API interface gives user access to results within the result contianar. would require user to create an instance of the <code class="xref py py-class docutils literal notranslate"><span class="pre">PyDSS.dssInstacne</span></code> class. This would require the user to define the arguments dictionary. If structured correctly, user should be able to invove an instance of PyDSS. Ensure within the passed arguments dictionary,</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;Return Results&quot;</span> <span class="p">:</span> <span class="bp">True</span>
</pre></div>
</div>
<p>Else, None will be returned at simulator steps through time. Once an instance has been created, simulation may be controlled externaly. A simple example is as follows:</p>
<p>A minimal HELICS interfacing example has been provided as a PyDSS project in ~PyDSS/exmaples/External_interfacing_example. Within the folder, ~PyDSS/examples/External_interfacing_example/pyDSS_project a scenario called ‘API_interface’ has been defined. Enabling the HELICS interface requires user to define additional patammeters in the scenario TOML file.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">click</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="nd">@click.command</span><span class="p">()</span>
<span class="nd">@click.option</span><span class="p">(</span><span class="s1">&#39;--pydss_path&#39;</span><span class="p">,</span>
                          <span class="n">default</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;C:\Users\alatif\Desktop\PyDSS&#39;</span><span class="p">)</span>
<span class="nd">@click.option</span><span class="p">(</span><span class="s1">&#39;--sim_path&#39;</span><span class="p">,</span>
                          <span class="n">default</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;C:\Users\alatif\Desktop\PyDSS\examples\External_interfacing_example\pyDSS_project\PyDSS Scenarios&#39;</span><span class="p">)</span>
<span class="nd">@click.option</span><span class="p">(</span><span class="s1">&#39;--sim_file&#39;</span><span class="p">,</span>
                          <span class="n">default</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;api_interface.toml&#39;</span><span class="p">)</span>
<span class="nd">@click.option</span><span class="p">(</span><span class="s1">&#39;--run_simulation&#39;</span><span class="p">,</span>
                          <span class="n">default</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="nd">@click.option</span><span class="p">(</span><span class="s1">&#39;--generate_visuals&#39;</span><span class="p">,</span>
                          <span class="n">default</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">run_pyDSS</span><span class="p">(</span><span class="n">pydss_path</span><span class="p">,</span> <span class="n">sim_path</span><span class="p">,</span> <span class="n">sim_file</span><span class="p">,</span> <span class="n">run_simulation</span><span class="p">,</span> <span class="n">generate_visuals</span><span class="p">):</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pydss_path</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pydss_path</span><span class="p">,</span> <span class="s1">&#39;PyDSS&#39;</span><span class="p">))</span>
        <span class="kn">from</span> <span class="nn">pyDSS</span> <span class="kn">import</span> <span class="n">instance</span> <span class="k">as</span> <span class="n">dssInstance</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">dssInstance</span><span class="p">()</span> <span class="c1"># Create an instance of PyDSS</span>
        <span class="n">sim_args</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">update_scenario_settigs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sim_path</span><span class="p">,</span> <span class="n">sim_file</span><span class="p">))</span> <span class="c1"># Update the default settings</span>
        <span class="n">dssInstance</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">create_dss_instance</span><span class="p">(</span><span class="n">sim_args</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span> <span class="c1"># Run simulation for five time steps</span>
                <span class="n">x</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Load.mpx000635970&#39;</span><span class="p">:{</span><span class="s1">&#39;kW&#39;</span><span class="p">:</span><span class="mf">7.28</span><span class="p">}}</span>
                <span class="n">results</span> <span class="o">=</span> <span class="n">dssInstance</span><span class="o">.</span><span class="n">RunStep</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="c1"># Update the value of a load</span>
                <span class="k">print</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;Load.mpx000635970&#39;</span><span class="p">][</span><span class="s1">&#39;Powers&#39;</span><span class="p">][</span><span class="s1">&#39;E&#39;</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">])</span>  <span class="n">Update</span> <span class="n">the</span> <span class="n">new</span> <span class="n">value</span> <span class="n">of</span> <span class="n">the</span> <span class="n">load</span>
        <span class="n">dssInstance</span><span class="o">.</span><span class="n">ResultContainer</span><span class="o">.</span><span class="n">ExportResults</span><span class="p">()</span> <span class="c1"># Export the results</span>
        <span class="n">dssInstance</span><span class="o">.</span><span class="n">DeleteInstance</span><span class="p">()</span>
        <span class="k">del</span> <span class="n">a</span>
<span class="n">run_pyDSS</span><span class="p">()</span>
</pre></div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">The socket interface</a></li>
<li><a class="reference internal" href="#the-helics-interface">The HELICS interface</a></li>
<li><a class="reference internal" href="#the-api-interface">The API interface</a></li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="External interfaces for cosimulation.html"
                        title="previous chapter">External PyDSS interfaces</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="Automated comparison of scenarios.html"
                        title="next chapter">Automated scenario comparison</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/interfaces.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="Automated comparison of scenarios.html" title="Automated scenario comparison"
             >next</a> |</li>
        <li class="right" >
          <a href="External interfaces for cosimulation.html" title="External PyDSS interfaces"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">PyDSS 0.0.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="External interfaces for cosimulation.html" >External PyDSS interfaces</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2019, Aadil Latif.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.2.0.
    </div>
  </body>
</html>