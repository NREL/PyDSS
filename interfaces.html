<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>The socket interface &mdash; PyDSS 0.0.1 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/graphviz.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Automated scenario comparison" href="Automated%20comparison%20of%20scenarios.html" />
    <link rel="prev" title="External PyDSS interfaces" href="External%20interfaces%20for%20cosimulation.html" />
    <link href="_static/style.css" rel="stylesheet" type="text/css">

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> PyDSS
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quick Start Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="quickstart.html#create-an-empty-project">Create an empty project</a></li>
<li class="toctree-l2"><a class="reference internal" href="quickstart.html#customize-the-simulation-settings">Customize the simulation settings</a></li>
<li class="toctree-l2"><a class="reference internal" href="quickstart.html#opendss-models">OpenDSS Models</a></li>
<li class="toctree-l2"><a class="reference internal" href="quickstart.html#run-the-simulation">Run the simulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="quickstart.html#results">Results</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="tutorial.html">Tutorial</a><ul>
<li class="toctree-l2"><a class="reference internal" href="tutorial.html#create-a-project">Create a project</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial.html#exporting-data">Exporting Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial.html#pre-filtering-export-data">Pre-filtering Export Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial.html#run-a-project">Run a project</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial.html#analyze-results">Analyze results</a><ul>
<li class="toctree-l3"><a class="reference internal" href="tutorial.html#exported-csv-files">Exported CSV files</a></li>
<li class="toctree-l3"><a class="reference internal" href="tutorial.html#data-viewer">Data Viewer</a></li>
<li class="toctree-l3"><a class="reference internal" href="tutorial.html#access-results-programmatically">Access results programmatically</a><ul>
<li class="toctree-l4"><a class="reference internal" href="tutorial.html#load-element-classes-and-properties">Load element classes and properties</a></li>
<li class="toctree-l4"><a class="reference internal" href="tutorial.html#read-a-dataframe-for-one-element">Read a dataframe for one element</a></li>
<li class="toctree-l4"><a class="reference internal" href="tutorial.html#read-a-dataframe-for-one-element-with-a-specific-option">Read a dataframe for one element with a specific option</a></li>
<li class="toctree-l4"><a class="reference internal" href="tutorial.html#read-a-dataframe-for-one-element-with-an-option-matching-a-regular-expression">Read a dataframe for one element with an option matching a regular expression</a></li>
<li class="toctree-l4"><a class="reference internal" href="tutorial.html#read-the-total-value-for-a-property-stored-with-store-values-type-sum">Read the total value for a property stored with <code class="docutils literal notranslate"><span class="pre">store_values_type</span> <span class="pre">=</span> <span class="pre">&quot;sum&quot;</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="tutorial.html#find-out-all-options-available-for-a-property">Find out all options available for a property</a></li>
<li class="toctree-l4"><a class="reference internal" href="tutorial.html#find-out-what-option-values-are-present-for-a-property">Find out what option values are present for a property</a></li>
<li class="toctree-l4"><a class="reference internal" href="tutorial.html#read-a-dataframe-for-all-elements">Read a dataframe for all elements</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="tutorial.html#estimate-space-required-by-pydss-simulation">Estimate space required by PyDSS simulation</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="project_layout.html">PyDSS Project Layout</a><ul>
<li class="toctree-l2"><a class="reference internal" href="project_layout.html#simulation-settings">Simulation Settings</a></li>
<li class="toctree-l2"><a class="reference internal" href="project_layout.html#scenarios">Scenarios</a></li>
<li class="toctree-l2"><a class="reference internal" href="project_layout.html#exports">Exports</a></li>
<li class="toctree-l2"><a class="reference internal" href="project_layout.html#reports">Reports</a></li>
<li class="toctree-l2"><a class="reference internal" href="project_layout.html#example-layout">Example layout</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="simulation_settings.html">Simulation Settings</a><ul>
<li class="toctree-l2"><a class="reference internal" href="simulation_settings.html#simulationsettings">SimulationSettings</a></li>
<li class="toctree-l2"><a class="reference internal" href="simulation_settings.html#project">Project</a></li>
<li class="toctree-l2"><a class="reference internal" href="simulation_settings.html#scenario">Scenario</a></li>
<li class="toctree-l2"><a class="reference internal" href="simulation_settings.html#scenariopostprocess">ScenarioPostProcess</a></li>
<li class="toctree-l2"><a class="reference internal" href="simulation_settings.html#snapshottimepointselectionconfig">SnapshotTimePointSelectionConfig</a></li>
<li class="toctree-l2"><a class="reference internal" href="simulation_settings.html#exports">Exports</a></li>
<li class="toctree-l2"><a class="reference internal" href="simulation_settings.html#frequency">Frequency</a></li>
<li class="toctree-l2"><a class="reference internal" href="simulation_settings.html#helics">Helics</a></li>
<li class="toctree-l2"><a class="reference internal" href="simulation_settings.html#logging">Logging</a></li>
<li class="toctree-l2"><a class="reference internal" href="simulation_settings.html#montecarlo">MonteCarlo</a></li>
<li class="toctree-l2"><a class="reference internal" href="simulation_settings.html#plots">Plots</a></li>
<li class="toctree-l2"><a class="reference internal" href="simulation_settings.html#profiles">Profiles</a></li>
<li class="toctree-l2"><a class="reference internal" href="simulation_settings.html#reports">Reports</a></li>
<li class="toctree-l2"><a class="reference internal" href="simulation_settings.html#simulationrange">SimulationRange</a></li>
<li class="toctree-l2"><a class="reference internal" href="simulation_settings.html#capacitorstatechangecountreport">CapacitorStateChangeCountReport</a></li>
<li class="toctree-l2"><a class="reference internal" href="simulation_settings.html#feederlossesreport">FeederLossesReport</a></li>
<li class="toctree-l2"><a class="reference internal" href="simulation_settings.html#pvclippingreport">PvClippingReport</a></li>
<li class="toctree-l2"><a class="reference internal" href="simulation_settings.html#pvcurtailmentreport">PvCurtailmentReport</a></li>
<li class="toctree-l2"><a class="reference internal" href="simulation_settings.html#regcontroltapnumberchangecountsreport">RegControlTapNumberChangeCountsReport</a></li>
<li class="toctree-l2"><a class="reference internal" href="simulation_settings.html#thermalmetricsreport">ThermalMetricsReport</a></li>
<li class="toctree-l2"><a class="reference internal" href="simulation_settings.html#voltagemetricsreport">VoltageMetricsReport</a></li>
<li class="toctree-l2"><a class="reference internal" href="simulation_settings.html#reportbase">ReportBase</a><ul>
<li class="toctree-l3"><a class="reference internal" href="default_simulation_settings.html">Default Simulation Settings</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="examples.html">Example PyDSS simulations</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="Dynamic%20visualization%20capabilities.html">Dynamic visualization capabilities</a><ul>
<li class="toctree-l3"><a class="reference internal" href="Dynamic%20plots.html">Frequency sweep plot</a></li>
<li class="toctree-l3"><a class="reference internal" href="Dynamic%20plots.html#gis-plot">GIS plot</a></li>
<li class="toctree-l3"><a class="reference internal" href="Dynamic%20plots.html#histogram-plot">Histogram plot</a></li>
<li class="toctree-l3"><a class="reference internal" href="Dynamic%20plots.html#voltage-sag-plot">Voltage sag plot</a></li>
<li class="toctree-l3"><a class="reference internal" href="Dynamic%20plots.html#time-series-plot">Time series plot</a></li>
<li class="toctree-l3"><a class="reference internal" href="Dynamic%20plots.html#voltage-current-heatmap-plot">Voltage / Current heatmap plot</a></li>
<li class="toctree-l3"><a class="reference internal" href="Dynamic%20plots.html#xy-plots">XY plots</a></li>
<li class="toctree-l3"><a class="reference internal" href="Creating%20custom%20dynamic%20plots.html">Development of custom dynamic plots</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="Extended%20controls%20library.html">Extended controls library</a><ul>
<li class="toctree-l3"><a class="reference internal" href="Creating%20custom%20controls.html">Extending PyDSS controllers</a></li>
</ul>
</li>
<li class="toctree-l2 current"><a class="reference internal" href="External%20interfaces%20for%20cosimulation.html">External PyDSS interfaces</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">The socket interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="#the-helics-interface">The HELICS interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="#the-api-interface">The API interface</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="Automated%20comparison%20of%20scenarios.html">Automated scenario comparison</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Result%20management.html">Enhanced result export features</a></li>
<li class="toctree-l1"><a class="reference internal" href="reports.html">Reports</a><ul>
<li class="toctree-l2"><a class="reference internal" href="reports.html#global-settings">Global settings</a><ul>
<li class="toctree-l3"><a class="reference internal" href="reports.html#format">Format</a></li>
<li class="toctree-l3"><a class="reference internal" href="reports.html#granularity">Granularity</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="reports.html#export-parameters">Export Parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="reports.html#output-data">Output Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="reports.html#adding-new-reports">Adding New Reports</a></li>
<li class="toctree-l2"><a class="reference internal" href="reports.html#examples">Examples</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="hdf-data-format.html">HDF Data Format</a><ul>
<li class="toctree-l2"><a class="reference internal" href="hdf-data-format.html#layout">Layout</a><ul>
<li class="toctree-l3"><a class="reference internal" href="hdf-data-format.html#common-metadata">Common Metadata</a></li>
<li class="toctree-l3"><a class="reference internal" href="hdf-data-format.html#dataset-metadata">Dataset Metadata</a><ul>
<li class="toctree-l4"><a class="reference internal" href="hdf-data-format.html#attributes-per-dataset">Attributes per dataset</a></li>
<li class="toctree-l4"><a class="reference internal" href="hdf-data-format.html#metadata-datasets-per-dataset">Metadata datasets per dataset</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="hdf-data-format.html#examples">Examples</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="PyDSS.html">PyDSS</a><ul class="simple">
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">PyDSS</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="examples.html">Example PyDSS simulations</a> &raquo;</li>
          <li><a href="External%20interfaces%20for%20cosimulation.html">External PyDSS interfaces</a> &raquo;</li>
      <li>The socket interface</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/interfaces.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <p>Within the example folder the project named external interfaces provides an example usage of all three interafces.</p>
<section id="the-socket-interface">
<h1>The socket interface<a class="headerlink" href="#the-socket-interface" title="Permalink to this headline">¶</a></h1>
<p>The socket interface is implemented as a PyDSS pyController. Implmentation details and expected inputs are detailed here: <code class="xref py py-class docutils literal notranslate"><span class="pre">PyDSS.pyControllers.Controllers.SocketController.SocketController</span></code>. The socket controller is weill suited in situatons where an existing controller needs to be integrated to the simulation environment. An exmaple of this would be integrating a controller for thermostatically controlled loads implemeted in say Modelica or Python. This allows user to integrate controller, without making changes to the implemented controller. With a little effort, the same controller can be implemented as a pyController object in PyDSS.</p>
<p>The socket interface in PyDSS also come in handy, when setting up a hardware-in-loop type simulations and integrating the simulation engine with actual hardware. Interfaces similar to raw socket implementations have been developed (to be  open-sourced at a time) for Modbus-TCP and DNP3 communcations have developed and tested with PyDSS with sucess. A minimal socket interfacing example has been provided as a PyDSS project in ~PyDSS/exmaples/External_interfacing_example. Within the folder, ~/PyDSS/examples/External_interfacing_example/pyDSS_project a scenario called ‘socket_interface’ has been defined. Socket contntroller definations have been detailed with the ‘pyControllerList’ folder.</p>
<p>In this example, each iteration, voltage and power information is being exported via the socket and new value recieved is used to update the ‘kW’ property of the load. Once the inputs, outputs, IP and port have been defined, the next step is to create a TOML file and define simulation settings.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;Project Path&quot;</span> <span class="o">=</span> <span class="s2">&quot;C:</span><span class="se">\\</span><span class="s2">Users</span><span class="se">\\</span><span class="s2">alatif</span><span class="se">\\</span><span class="s2">Desktop</span><span class="se">\\</span><span class="s2">PyDSS</span><span class="se">\\</span><span class="s2">examples</span><span class="se">\\</span><span class="s2">External_interfacing_example&quot;</span>
<span class="s2">&quot;Simulation Type&quot;</span> <span class="o">=</span> <span class="s2">&quot;QSTS&quot;</span>
<span class="s2">&quot;Active Project&quot;</span> <span class="o">=</span> <span class="s2">&quot;pyDSS_project&quot;</span>
<span class="s2">&quot;Active Scenario&quot;</span> <span class="o">=</span> <span class="s2">&quot;socket_interface&quot;</span>
<span class="s2">&quot;DSS File&quot;</span> <span class="o">=</span> <span class="s2">&quot;Master_Spohn_existing_VV.dss&quot;</span>
</pre></div>
</div>
<p>A small script is used to run the particular scenario.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">click</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="nd">@click</span><span class="o">.</span><span class="n">command</span><span class="p">()</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s1">&#39;--pydss_path&#39;</span><span class="p">,</span>
                          <span class="n">default</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;C:\Users\alatif\Desktop\PyDSS&#39;</span><span class="p">)</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s1">&#39;--sim_path&#39;</span><span class="p">,</span>
                          <span class="n">default</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;C:\Users\alatif\Desktop\PyDSS\examples\External_interfacing_example\pyDSS_project\Scenarios&#39;</span><span class="p">)</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s1">&#39;--sim_file&#39;</span><span class="p">,</span>
                          <span class="n">default</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;socket_interface.toml&#39;</span><span class="p">)</span> <span class="c1">#The TOML file contains simulation settings for the particular scenario</span>
<span class="k">def</span> <span class="nf">run_pyDSS</span><span class="p">(</span><span class="n">pydss_path</span><span class="p">,</span> <span class="n">sim_path</span><span class="p">,</span> <span class="n">sim_file</span><span class="p">):</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pydss_path</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pydss_path</span><span class="p">,</span> <span class="s1">&#39;PyDSS&#39;</span><span class="p">))</span>
        <span class="kn">from</span> <span class="nn">pyDSS</span> <span class="kn">import</span> <span class="n">instance</span> <span class="k">as</span> <span class="n">dssInstance</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">dssInstance</span><span class="p">()</span>                           <span class="c1">#Create an instance of PyDSS</span>
        <span class="n">a</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sim_path</span><span class="p">,</span> <span class="n">sim_file</span><span class="p">))</span>     <span class="c1">#Run the simulation</span>

<span class="n">run_pyDSS</span><span class="p">()</span>
</pre></div>
</div>
<p>Finally, the minimal example below shows how to retrive data from the sockets and return new values for parameters defined in the definations file.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># first of all import the socket library</span>
<span class="kn">import</span> <span class="nn">socket</span>
<span class="kn">import</span> <span class="nn">struct</span>

<span class="c1"># next create a socket object</span>
<span class="n">sockets</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">()</span>
        <span class="n">s</span><span class="o">.</span><span class="n">bind</span><span class="p">((</span><span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span> <span class="mi">5001</span> <span class="o">+</span> <span class="n">i</span><span class="p">))</span>
        <span class="n">s</span><span class="o">.</span><span class="n">listen</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">sockets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="c1"># Establish connection with client.</span>
        <span class="n">conns</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">sockets</span><span class="p">:</span>
                <span class="n">c</span><span class="p">,</span> <span class="n">addr</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span>
                <span class="n">conns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">conns</span><span class="p">:</span> <span class="c1">#Reading data from all ports</span>
                        <span class="n">Data</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">Data</span><span class="p">:</span> <span class="c1">#Creating a list of doubles from the recieved byte stream</span>
                                <span class="n">numDoubles</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Data</span><span class="p">)</span> <span class="o">/</span> <span class="mi">8</span><span class="p">)</span>
                                <span class="n">tag</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">numDoubles</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;d&#39;</span>
                                <span class="n">Data</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="n">Data</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">c</span> <span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">conns</span><span class="p">,</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">]):</span> <span class="c1">#Writing data to all ports</span>
                        <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span><span class="p">]</span>
                        <span class="n">c</span><span class="o">.</span><span class="n">sendall</span><span class="p">(</span><span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">d&#39;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">),</span> <span class="o">*</span><span class="n">values</span><span class="p">))</span>
</pre></div>
</div>
</section>
<section id="the-helics-interface">
<h1>The HELICS interface<a class="headerlink" href="#the-helics-interface" title="Permalink to this headline">¶</a></h1>
<p>Hierarchical Engine for Large-scale Infrastructure Co-Simulation (HELICS) provides an open-source, general-purpose, modular, highly-scalable co-simulation framework that runs cross-platform (Linux, Windows, and Mac OS X). It is not a modeling tool by itself, but rather an integration tool that enables multiple existing simulation tools (and/or multiple instances of the same tool), known as “federates,” to exchange data during runtime and stay synchronized in time such that together they act as one large simulation, or “federation”. This enables bringing together established (or new/emerging) off-the-shelf tools from multiple domains to form a complex software-simulation without having to change the individual tools (known as “black-box” modeling). All that is required is for someone to write a thin interface layer for each tool that interfaces with existing simulation time control and data value updating, such as through an existing scripting interface. Moreover, the HELICS community has a growing ecosystem of established interfaces for popular tools, such that many users can simply mix and match existing tools with their own data and run complex co-simulations with minimal coding. More information on HELICS can be found here (<a class="reference external" href="https://github.com/GMLC-TDC/HELICS">https://github.com/GMLC-TDC/HELICS</a>).</p>
<p>The HELICS interface for PyDSS is built to reduuce complexity of setting up large scale cosimulation scenarios. The user is requuired to publications and suscriptions. Details on the format have been detailed here: <a class="reference internal" href="Result%20management.html#enhanced-result-export-features"><span class="std std-ref">Enhanced result export features</span></a></p>
<p>A minimal HELICS interfacing example has been provided as a PyDSS project in ~PyDSS/exmaples/External_interfacing_example. Within the folder, ~PyDSS/examples/External_interfacing_example/pyDSS_project a scenario called ‘helics_interface’ has been defined. Enabling the HELICS interface requires user to define additional patammeters in the scenario TOML file.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;Project Path&quot;</span> <span class="o">=</span> <span class="s2">&quot;C:</span><span class="se">\\</span><span class="s2">Users</span><span class="se">\\</span><span class="s2">alatif</span><span class="se">\\</span><span class="s2">Desktop</span><span class="se">\\</span><span class="s2">PyDSS</span><span class="se">\\</span><span class="s2">examples</span><span class="se">\\</span><span class="s2">External_interfacing_example&quot;</span>
<span class="s2">&quot;Simulation Type&quot;</span> <span class="o">=</span> <span class="s2">&quot;QSTS&quot;</span>
<span class="s2">&quot;Active Project&quot;</span> <span class="o">=</span> <span class="s2">&quot;pyDSS_project&quot;</span>
<span class="s2">&quot;Active Scenario&quot;</span> <span class="o">=</span> <span class="s2">&quot;helics_interface&quot;</span>
<span class="s2">&quot;DSS File&quot;</span> <span class="o">=</span> <span class="s2">&quot;Master_Spohn_existing_VV.dss&quot;</span>
<span class="s2">&quot;Co-simulation Mode&quot;</span> <span class="o">=</span> <span class="n">true</span>
<span class="s2">&quot;Federate name&quot;</span> <span class="o">=</span> <span class="s2">&quot;PyDSS&quot;</span>
</pre></div>
</div>
<ul class="simple">
<li><p>“Co-simulation Mode” : Set to ‘true’ to enable the HELICS interface. By default it is set to ‘false’</p></li>
<li><p>“Federate name” : Required to identify a federate ina cosimulation with a large number of federates.</p></li>
</ul>
<p>Default values for additional simulation settings are as follows. For more information on how to appropriately set these values please look at HELICS documentaion</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;Time delta&quot;</span> <span class="o">=</span> <span class="mf">0.01</span>
<span class="s2">&quot;Core type&quot;</span> <span class="o">=</span> <span class="s2">&quot;zmq&quot;</span>
<span class="s2">&quot;Uninterruptible&quot;</span> <span class="o">=</span> <span class="n">true</span>
<span class="s2">&quot;Helics logging level&quot;</span> <span class="o">=</span> <span class="mi">5</span>
</pre></div>
</div>
<p>For a helics example a minimal dummy federate has been defined using the HELICS Python interaface. The dummy federate script creates a broker and a federate. The federate subsscribes to feeder total power and publishes actie power values for three loads in the network.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">helics</span> <span class="k">as</span> <span class="nn">h</span>
<span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">pi</span>
<span class="kn">import</span> <span class="nn">random</span>

<span class="n">initstring</span> <span class="o">=</span> <span class="s2">&quot;-f 2 --name=mainbroker&quot;</span>
<span class="n">fedinitstring</span> <span class="o">=</span> <span class="s2">&quot;--broker=mainbroker --federates=1&quot;</span>
<span class="n">deltat</span> <span class="o">=</span> <span class="mf">0.01</span>

<span class="n">helicsversion</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">helicsGetVersion</span><span class="p">()</span>


<span class="c1"># Create broker #</span>
<span class="n">broker</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">helicsCreateBroker</span><span class="p">(</span><span class="s2">&quot;zmq&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">initstring</span><span class="p">)</span>

<span class="n">isconnected</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">helicsBrokerIsConnected</span><span class="p">(</span><span class="n">broker</span><span class="p">)</span>

<span class="c1"># Create Federate Info object that describes the federate properties #</span>
<span class="n">fedinfo</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">helicsCreateFederateInfo</span><span class="p">()</span>

<span class="c1"># Set Federate name #</span>
<span class="n">h</span><span class="o">.</span><span class="n">helicsFederateInfoSetCoreName</span><span class="p">(</span><span class="n">fedinfo</span><span class="p">,</span> <span class="s2">&quot;Test Federate&quot;</span><span class="p">)</span>

<span class="c1"># Set core type from string #</span>
<span class="n">h</span><span class="o">.</span><span class="n">helicsFederateInfoSetCoreTypeFromString</span><span class="p">(</span><span class="n">fedinfo</span><span class="p">,</span> <span class="s2">&quot;zmq&quot;</span><span class="p">)</span>

<span class="c1"># Federate init string #</span>
<span class="n">h</span><span class="o">.</span><span class="n">helicsFederateInfoSetCoreInitString</span><span class="p">(</span><span class="n">fedinfo</span><span class="p">,</span> <span class="n">fedinitstring</span><span class="p">)</span>

<span class="c1"># Set the message interval (timedelta) for federate. Note th#</span>
<span class="c1"># HELICS minimum message time interval is 1 ns and by default</span>
<span class="c1"># it uses a time delta of 1 second. What is provided to the</span>
<span class="c1"># setTimedelta routine is a multiplier for the default timedelta.</span>

<span class="c1"># Set one second message interval #</span>
<span class="n">h</span><span class="o">.</span><span class="n">helicsFederateInfoSetTimeProperty</span><span class="p">(</span><span class="n">fedinfo</span><span class="p">,</span> <span class="n">h</span><span class="o">.</span><span class="n">helics_property_time_delta</span><span class="p">,</span> <span class="n">deltat</span><span class="p">)</span>

<span class="c1"># Create value federate #</span>
<span class="n">vfed</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">helicsCreateValueFederate</span><span class="p">(</span><span class="s2">&quot;Test Federate&quot;</span><span class="p">,</span> <span class="n">fedinfo</span><span class="p">)</span>

<span class="c1"># Register the publication #</span>
<span class="n">pub1</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">helicsFederateRegisterGlobalTypePublication</span><span class="p">(</span><span class="n">vfed</span><span class="p">,</span> <span class="s2">&quot;test.load1.power&quot;</span><span class="p">,</span> <span class="s2">&quot;double&quot;</span><span class="p">,</span> <span class="s2">&quot;kW&quot;</span><span class="p">)</span>
<span class="n">pub2</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">helicsFederateRegisterGlobalTypePublication</span><span class="p">(</span><span class="n">vfed</span><span class="p">,</span> <span class="s2">&quot;test.load2.power&quot;</span><span class="p">,</span> <span class="s2">&quot;double&quot;</span><span class="p">,</span> <span class="s2">&quot;kW&quot;</span><span class="p">)</span>
<span class="n">pub3</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">helicsFederateRegisterGlobalTypePublication</span><span class="p">(</span><span class="n">vfed</span><span class="p">,</span> <span class="s2">&quot;test.load3.power&quot;</span><span class="p">,</span> <span class="s2">&quot;double&quot;</span><span class="p">,</span> <span class="s2">&quot;kW&quot;</span><span class="p">)</span>
<span class="n">sub1</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">helicsFederateRegisterSubscription</span><span class="p">(</span><span class="n">vfed</span><span class="p">,</span> <span class="s2">&quot;Circuit.heco19021.TotalPower.E&quot;</span><span class="p">,</span> <span class="s2">&quot;kW&quot;</span><span class="p">)</span>
<span class="c1"># Enter execution mode #</span>
<span class="n">h</span><span class="o">.</span><span class="n">helicsFederateEnterExecutingMode</span><span class="p">(</span><span class="n">vfed</span><span class="p">)</span>

<span class="c1"># This federate will be publishing deltat*pi for numsteps steps #</span>

<span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">96</span><span class="p">):</span>
        <span class="n">currenttime</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">helicsFederateRequestTime</span><span class="p">(</span><span class="n">vfed</span><span class="p">,</span> <span class="n">t</span> <span class="o">*</span> <span class="mi">15</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
        <span class="n">h</span><span class="o">.</span><span class="n">helicsPublicationPublishDouble</span><span class="p">(</span><span class="n">pub1</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">)</span>
        <span class="n">h</span><span class="o">.</span><span class="n">helicsPublicationPublishDouble</span><span class="p">(</span><span class="n">pub2</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">)</span>
        <span class="n">h</span><span class="o">.</span><span class="n">helicsPublicationPublishDouble</span><span class="p">(</span><span class="n">pub3</span><span class="p">,</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">*</span> <span class="mi">12</span><span class="p">)</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">helicsInputGetString</span><span class="p">(</span><span class="n">sub1</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.01</span><span class="p">)</span>

<span class="n">h</span><span class="o">.</span><span class="n">helicsFederateFinalize</span><span class="p">(</span><span class="n">vfed</span><span class="p">)</span>
<span class="k">while</span> <span class="n">h</span><span class="o">.</span><span class="n">helicsBrokerIsConnected</span><span class="p">(</span><span class="n">broker</span><span class="p">):</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="n">h</span><span class="o">.</span><span class="n">helicsFederateFree</span><span class="p">(</span><span class="n">vfed</span><span class="p">)</span>
<span class="n">h</span><span class="o">.</span><span class="n">helicsCloseLibrary</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="the-api-interface">
<h1>The API interface<a class="headerlink" href="#the-api-interface" title="Permalink to this headline">¶</a></h1>
<p>Using the API interface gives user access to results within the result contianar. would require user to create an instance of the <code class="xref py py-class docutils literal notranslate"><span class="pre">PyDSS.dssInstacne</span></code> class. This would require the user to define the arguments dictionary. If structured correctly, user should be able to invove an instance of PyDSS. Ensure within the passed arguments dictionary,</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;Return Results&quot;</span> <span class="p">:</span> <span class="kc">True</span>
</pre></div>
</div>
<p>Else, None will be returned at simulator steps through time. Once an instance has been created, simulation may be controlled externaly. A simple example is as follows:</p>
<p>A minimal HELICS interfacing example has been provided as a PyDSS project in ~PyDSS/exmaples/External_interfacing_example. Within the folder, ~PyDSS/examples/External_interfacing_example/pyDSS_project a scenario called ‘API_interface’ has been defined. Enabling the HELICS interface requires user to define additional patammeters in the scenario TOML file.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">click</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="nd">@click</span><span class="o">.</span><span class="n">command</span><span class="p">()</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s1">&#39;--pydss_path&#39;</span><span class="p">,</span>
                          <span class="n">default</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;C:\Users\alatif\Desktop\PyDSS&#39;</span><span class="p">)</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s1">&#39;--sim_path&#39;</span><span class="p">,</span>
                          <span class="n">default</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;C:\Users\alatif\Desktop\PyDSS\examples\External_interfacing_example\pyDSS_project\Scenarios&#39;</span><span class="p">)</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s1">&#39;--sim_file&#39;</span><span class="p">,</span>
                          <span class="n">default</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;api_interface.toml&#39;</span><span class="p">)</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s1">&#39;--run_simulation&#39;</span><span class="p">,</span>
                          <span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s1">&#39;--generate_visuals&#39;</span><span class="p">,</span>
                          <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">run_pyDSS</span><span class="p">(</span><span class="n">pydss_path</span><span class="p">,</span> <span class="n">sim_path</span><span class="p">,</span> <span class="n">sim_file</span><span class="p">,</span> <span class="n">run_simulation</span><span class="p">,</span> <span class="n">generate_visuals</span><span class="p">):</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pydss_path</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pydss_path</span><span class="p">,</span> <span class="s1">&#39;PyDSS&#39;</span><span class="p">))</span>
        <span class="kn">from</span> <span class="nn">pyDSS</span> <span class="kn">import</span> <span class="n">instance</span> <span class="k">as</span> <span class="n">dssInstance</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">dssInstance</span><span class="p">()</span> <span class="c1"># Create an instance of PyDSS</span>
        <span class="n">sim_args</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">update_scenario_settigs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sim_path</span><span class="p">,</span> <span class="n">sim_file</span><span class="p">))</span> <span class="c1"># Update the default settings</span>
        <span class="n">dssInstance</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">create_dss_instance</span><span class="p">(</span><span class="n">sim_args</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span> <span class="c1"># Run simulation for five time steps</span>
                <span class="n">x</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Load.mpx000635970&#39;</span><span class="p">:{</span><span class="s1">&#39;kW&#39;</span><span class="p">:</span><span class="mf">7.28</span><span class="p">}}</span>
                <span class="n">results</span> <span class="o">=</span> <span class="n">dssInstance</span><span class="o">.</span><span class="n">RunStep</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="c1"># Update the value of a load</span>
        <span class="n">dssInstance</span><span class="o">.</span><span class="n">ResultContainer</span><span class="o">.</span><span class="n">ExportResults</span><span class="p">()</span> <span class="c1"># Export the results</span>
        <span class="n">dssInstance</span><span class="o">.</span><span class="n">DeleteInstance</span><span class="p">()</span>
        <span class="k">del</span> <span class="n">a</span>
<span class="n">run_pyDSS</span><span class="p">()</span>
</pre></div>
</div>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="External%20interfaces%20for%20cosimulation.html" class="btn btn-neutral float-left" title="External PyDSS interfaces" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="Automated%20comparison%20of%20scenarios.html" class="btn btn-neutral float-right" title="Automated scenario comparison" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2019, Aadil Latif.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>